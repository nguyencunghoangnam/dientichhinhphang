<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Mô phỏng diện tích hình phẳng</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.11.1/math.js"></script>
  <script>
    window.MathJax = {
      tex: {inlineMath: [['$', '$'], ['\\(', '\\)']]}
    };
  </script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Roboto', Arial, sans-serif;
      margin: 0;
      background: linear-gradient(120deg, #e3f0ff 0%, #f9f9f9 100%);
      min-height: 100vh;
    }
    .container {
      max-width: 760px;
      margin: 38px auto 0 auto;
      background: #fff;
      border-radius: 18px;
      box-shadow: 0 8px 32px #1976d233, 0 1.5px 10px #0001;
      padding: 32px 28px 36px 28px;
      position: relative;
      animation: fadeIn 1s;
      overflow: hidden;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(40px);}
      to { opacity: 1; transform: translateY(0);}
    }
    h2 {
      text-align: center;
      color: #1769aa;
      font-size: 2.1rem;
      font-weight: bold;
      letter-spacing: 1px;
      text-shadow: 0 2px 11px #bbe8ffb0, 0 1.5px 10px #fff5;
      margin-bottom: 26px;
    }
    #controls {
      background: linear-gradient(90deg, #e3f2fd 70%, #fff 100%);
      padding: 18px 18px 12px 18px;
      border-radius: 13px;
      box-shadow: 0 2px 12px #1976d22a;
      display: flex;
      flex-wrap: wrap;
      gap: 18px 18px;
      justify-content: center;
      align-items: center;
      font-size: 1.08rem;
      margin-bottom: 22px;
    }
    #controls label {
      font-weight: 500;
      color: #1769aa;
      margin-right: 3px;
      margin-bottom: 0;
      min-width: 170px;
      display: flex;
      align-items: center;
      gap: 7px;
    }
    #controls input[type="text"], 
    #controls input[type="number"] {
      padding: 8px 12px;
      border-radius: 7px;
      border: 1.5px solid #90caf9;
      font-size: 1.09rem;
      outline: none;
      background: #f8fafd;
      transition: border 0.2s;
      margin-right: 6px;
      min-width: 80px;
      max-width: 150px;
    }
    #controls input[type="text"]:focus, 
    #controls input[type="number"]:focus {
      border: 1.8px solid #1976d2;
      background: #e3f2fd;
    }
    #controls input[type="range"] {
      accent-color: #1976d2;
      margin-left: 8px;
      margin-right: 8px;
      width: 135px;
      vertical-align: middle;
      background: transparent;
    }
    #rectCount {
      color: #43a047;
      font-weight: 700;
      font-size: 1.12em;
      margin-left: 6px;
      margin-right: 4px;
    }
    #plot {
      background: #fcfdff;
      border-radius: 13px;
      box-shadow: 0 3px 19px #1976d222;
      padding: 6px 3px 12px 3px;
      margin-top: 2px;
      width: 100%; 
      height: 538px;
      min-height: 320px;
      transition: box-shadow 0.18s;
    }
    #plot:focus-within, #plot:active {
      box-shadow: 0 6px 30px #1976d255, 0 2px 8px #0001;
    }
    #result, #latex-display {
      margin-top: 22px;
      font-size: 1.16rem;
      border-radius: 8px;
      padding: 12px 17px;
      background: linear-gradient(90deg,#fffde7 80%,#e3f2fd 100%);
      color: #1976d2;
      box-shadow: 0 1.5px 8px #1976d21a;
      display: inline-block;
      max-width: 100%;
      word-break: break-word;
      text-align: left;
    }
    #result {
      font-weight: 700;
      color: #43a047;
      background: linear-gradient(90deg,#e0f7fa 80%,#fff 100%);
      margin-bottom: 8px;
    }
    #latex-display {
      font-weight: 500;
      background: linear-gradient(90deg,#fff 70%,#ede7f6 100%);
      color: #7b1fa2;
      margin-bottom: 8px;
      font-size: 1.15rem;
    }
    /* Responsive */
    @media (max-width: 900px) {
      .container { max-width: 99vw; padding: 3vw 2vw;}
      #plot { height: 55vw; min-height: 240px;}
    }
    @media (max-width: 700px) {
      .container { padding: 2vw 1vw;}
      h2 { font-size: 1.22rem; }
      #controls { font-size: 0.97rem; gap: 10px 7px;}
      #result, #latex-display { font-size: 1.01rem; padding: 9px 6px;}
    }
    @media (max-width: 480px) {
      .container { margin: 1vw; }
      #plot { height: 210px; min-height: 120px;}
      #controls { flex-direction: column; align-items: stretch;}
      h2 { font-size: 1.04rem; }
    }
.result-row {
  display: flex;
  flex-direction: column;
  align-items: flex-start;
  gap: 1px;
  margin-top: 22px;
}
#latex-display {
  margin-top: 7px;
  font-weight: 500;
  background: linear-gradient(90deg,#fff 70%,#ede7f6 100%);
  color: #7b1fa2;
  font-size: 1.15rem;
  display: block;
  box-shadow: 0 1.5px 8px #1976d21a;
  padding: 7px 17px 7px 17px;
}
  </style>
</head>
<body>
  <div class="container">
    <h2>
      Mô phỏng tính diện tích hình phẳng y = f(x)
    </h2>
    <div id="controls">
      <label>Hàm f(x): 
        <input type="text" id="functionInput" value="x^2">
      </label>
      <label>Cận a: 
        <input type="number" id="aInput" value="0">
      </label>
      <label>Cận b: 
        <input type="number" id="bInput" value="1">
      </label>
      <label>
        Số lượng hình chữ nhật: 
        <span id="rectCount">5</span>
        <input type="range" id="rectSlider" min="1" max="100" value="5">
      </label>
    </div>
    <div id="plot"></div>
    <div id="result"></div>
    <div id="latex-display"></div>
  </div>
<div class="result-row">
  <div id="result"></div>
  <div id="latex-display"></div>
</div>
  <script>
    const functionInput = document.getElementById('functionInput');
    const aInput = document.getElementById('aInput');
    const bInput = document.getElementById('bInput');
    const rectSlider = document.getElementById('rectSlider');
    const rectCountDisplay = document.getElementById('rectCount');
    const resultDisplay = document.getElementById('result');
    const latexDisplay = document.getElementById("latex-display");

    function numericalIntegral(f, a, b, steps = 1000) {
      const dx = (b - a) / steps;
      let area = 0;
      for (let i = 0; i < steps; i++) {
        const x1 = a + i * dx;
        const x2 = x1 + dx;
        area += (f(x1) + f(x2)) / 2 * dx; // Quy tắc hình thang
      }
      return area;
    }

    function updatePlot() {
      let fExpr;
      try {
        fExpr = math.compile(functionInput.value);
      } catch (err) {
        resultDisplay.innerHTML = "Hàm không hợp lệ.";
        return;
      }

      const a = parseFloat(aInput.value);
      const b = parseFloat(bInput.value);
      const n = parseInt(rectSlider.value);

      if (isNaN(a) || isNaN(b) || a === b || isNaN(n)) {
        resultDisplay.innerHTML = "Cận a, b hoặc số lượng hình chữ nhật không hợp lệ.";
        return;
      }

      const f = x => {
        try {
          return fExpr.evaluate({x});
        } catch (err) {
          return NaN;
        }
      };

      const dx = (b - a) / n;
      let x = [], y = [], rectX = [], rectH = [];
      let approxArea = 0;

      for (let i = 0; i <= 100; i++) {
        const xi = a + (b - a) * i / 100;
        x.push(xi);
        y.push(f(xi));
      }

      for (let i = 0; i < n; i++) {
        const xi = a + i * dx;
        const height = f(xi);
        if (!isNaN(height)) approxArea += height * dx;

        rectX.push(xi + dx / 2);
        rectH.push(height);
      }

      const integral = numericalIntegral(f, a, b);
      const absIntegral = numericalIntegral(x => Math.abs(f(x)), a, b);

      const functionTrace = {
        x: x, y: y, mode: 'lines', name: 'Hàm số', line: { color: '#1976d2', width: 2.3 }
      };

      const rectangles = {
        type: 'bar',
        x: rectX,
        y: rectH,
        width: dx,
        name: 'Tổng hình chữ nhật',
        marker: { color: 'rgba(255,100,100,0.68)' },
        opacity: 0.6
      };

      Plotly.newPlot('plot', [functionTrace, rectangles], {
        title: '',
        xaxis: { title: 'x', zerolinecolor: "#90caf9", gridcolor: "#e3f2fd" },
        yaxis: { title: 'y', zerolinecolor: "#90caf9", gridcolor: "#e3f2fd" },
        showlegend: true,
        legend: {
          orientation: "h",
          y: -0.18,
          font: { size: 13, family: 'Roboto', color: '#1769aa' }
        },
        paper_bgcolor: 'rgba(0,0,0,0)',
        plot_bgcolor: 'rgba(0,0,0,0)',
        margin: { t: 10, l: 46, r: 24, b: 38 }
      });

      resultDisplay.innerHTML = `Diện tích xấp xỉ (tổng hình chữ nhật): <span style="color:#1769aa">${approxArea.toFixed(6)}</span>`;

      latexDisplay.innerHTML = `\\[
        \\int_{${a}}^{${b}} f(x)\\,dx = ${integral.toFixed(6)}
        \\] \\[
        \\int_{${a}}^{${b}} |f(x)|\\,dx = ${absIntegral.toFixed(6)}
        \\]`;
      MathJax.typesetPromise();
    }

    [functionInput, aInput, bInput].forEach(input => input.addEventListener('change', updatePlot));
    rectSlider.addEventListener('input', () => {
      rectCountDisplay.textContent = rectSlider.value;
      updatePlot();
    });

    updatePlot();
  </script>
</body>
</html>
